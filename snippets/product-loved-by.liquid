{{ 'styles/product-loved-by.css' | asset_url | stylesheet_tag }}

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<style>
  #description-{{ section.id }} {
    --font-primary: {{ settings.type_main_font.family }}, {{ settings.type_main_font.fallback_families }};
    --font-secondary: {{ settings.type_heading_font.family }};
    [x-cloak] { display: none !important; }
  }
</style>

<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('reviewSlider', () => ({
      currentIndex: 0,
      reviews: [
        {%- for block in section.blocks -%}
            {%- if block.type == 'review' -%}
                {
                  id: {{ forloop.index0 }},
                  rating: `{{ block.settings.rating }}`,
                  text: `{{ block.settings.text | escape }}`,
                  author: `{{ block.settings.author | escape }}`,
                  image: `{% if block.settings.image %}{{ block.settings.image | image_url: width: 400, height: 400, crop: 'center' }}{% else %}{{ product.featured_media | image_url: width: 400, height: 400, crop: 'center' }}{% endif %}`
                }{% unless forloop.last %},{% endunless %}
          {%- endif -%}
        {%- endfor -%}
      ],
      
      get current() {
        return this.reviews[this.currentIndex];
      },

      next() {
        this.currentIndex = (this.currentIndex + 1) % this.reviews.length;
      },
      prev() {
        this.currentIndex = (this.currentIndex - 1 + this.reviews.length) % this.reviews.length;
      },
      goTo(index) {
        this.currentIndex = index;
      }
    }))
  })
</script>

<section 
    id="description-{{ section.id }}" 
    class="container_component" 
    style="background-color: var(--color-tertiary-background);"
    x-data="reviewSlider()" 
    x-cloak
>
    
    <h2 class="product-loved-by_title">
        {{ section.settings.loved_title | default: "Loved by Our Customers"  }}
    </h2>

    <template x-if="reviews.length > 0">
      <div class="product-loved-by_container">
          
          <span class="product-loved-by_arrow left" @click="prev()" style="cursor: pointer;">
              <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="48px" width="48px" xmlns="http://www.w3.org/2000/svg"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"></path></svg>
          </span>
          
          <div style="display: flex; flex-direction: column; align-items: center; width: 100%;" 
               x-key="currentIndex"
               x-transition:enter="transition ease-out duration-300"
               x-transition:enter-start="opacity-0 transform scale-95"
               x-transition:enter-end="opacity-100 transform scale-100">
            
            <div class="product-loved-by_rating-container" >
              <span class="product-loved-by_rating" x-text="current.rating"></span>
              <p class="product-loved-by_subtitle" x-text="current.text"></p>
              <p class="product-loved-by_author" x-text="current.author"></p>
            </div>
            
            <img 
                class="product-loved-by_image"
                :src="current.image"
                :alt="current.author"
                width="1376"
                height="256"
            >
          </div>

          <span class="product-loved-by_arrow right" @click="next()" style="cursor: pointer;">
              <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="50px" width="50px" xmlns="http://www.w3.org/2000/svg"><path d="M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z"></path></svg>
          </span>

          <div class="product-loved-by_dots">
              <template x-for="(review, index) in reviews" :key="index">
                <span 
                  class="product-loved-by_dot" 
                  :class="{ 'active': currentIndex === index }"
                  @click="goTo(index)"
                  style="cursor: pointer;"
                ></span>
              </template>
          </div>

      </div>
    </template>
</section>