<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.3.8/dist/photoswipe.css">

<style>
  .react-gallery__main-image {
    cursor: zoom-in;
  }
</style>

<div class="product-container">
  <div class="react-product-main" id="ProductSection-{{ section.id }}" data-section-id="{{ section.id }}">
    
    <div class="react-gallery">
      <div class="react-gallery__main-image-wrapper">
        {%- assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.featured_media -%}
        <img
          id="MainImage-{{ section.id }}"
          src="{{ featured_media | img_url: '712x712' }}"
          width="712px"
          height="712px"
          alt="{{ featured_media.alt | escape }}"
          class="react-gallery__main-image"
          onclick="openZoom()"
        >
      </div>
      
      {% if product.media.size > 1 %}
        <div class="react-gallery__thumbnails">
          {% for media in product.media %}
            <img
              src="{{ media | img_url: '172x172' }}"
              alt="{{ media.alt | escape }}"
              class="react-gallery__thumbnail {% if media == featured_media %}is-active{% endif %}"
              width="172px"
              height="172px"
              data-media-id="{{ media.id }}"
              data-image-src="{{ media | img_url: '712x712' }}"
              data-index="{{ forloop.index0 }}"
              onclick="changeImage(this)"
            >
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="react-info-container">
      {% form 'product', product, id: 'AddToCartForm', class: 'react-product-info' %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

        <div class="react-info__header">
          <h1 class="react-info__title">{{ product.title }}</h1>
          <p class="react-info__subtitle">{{ product.description | strip_html | truncatewords: 10 }}</p>
          <p class="react-info__price" id="ProductPrice">{{ product.selected_or_first_available_variant.price | money }}</p>
        </div>

        <div class="react-features">
          <div class="react-feature">
            {{ section.settings.svg-a }}
            <span>{{ section.settings.a-text | default: "Your happiness, our priority!" }}</span>
          </div>
          <div class="react-feature">
            {{ section.settings.svg-b }}
            <span>{{ section.settings.b-text | default: "Shipping to your door, anywhere in the world" }}</span>
          </div>
          <div class="react-feature">
            {{ section.settings.svg-c }}
            <span>{{ section.settings.c-text | default: "Shop with confidence—100% secure payments" }}</span>
          </div>
        </div>

        {% unless product.has_only_default_variant %}
          {% for option in product.options_with_values %}
            <div class="react-form-group">
              <label class="react-label">{{ option.name }}</label>
              <select class="react-select" name="options[{{ option.name | escape }}]">
                {% for value in option.values %}
                  <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
        {% endunless %}

        {% if section.settings.show_quantity %}
          <div class="react-form-group">
            <label class="react-label">Quantity</label>
            <div class="react-quantity-selector">
              <button type="button" class="react-quantity-btn" onclick="adjustQuantity(-1)">−</button>
              <input type="text" name="quantity" id="Quantity" value="1" min="1" class="react-quantity-input">
              <button type="button" class="react-quantity-btn" onclick="adjustQuantity(1)">+</button>
            </div>
          </div>
        {% else %}
          <input type="hidden" name="quantity" value="1">
        {% endif %}

        <div class="react-actions">
          <button type="submit" name="add" class="react-btn-add">Add to Cart</button>
          {% if section.settings.enable_payment_button %}
            {{ form | payment_button }}
          {% else %}
            <button type="button" class="react-btn-buy">Buy Now</button>
          {% endif %}
        </div>

        <div class="react-payment-section">
          <p class="react-payment-title">Payment methods accepted</p>
          <div class="react-payment-icons">
            {% for type in shop.enabled_payment_types %}
              <div class="react-payment-icon">
                {{ type | payment_type_svg_tag: class: 'payment-icon' }}
              </div>
            {% endfor %}
          </div>
          <p class="react-payment-secure">Guaranteed safe & secure checkout</p>
        </div>

        <div class="react-bundle-section">
          <h3 class="react-bundle-title">✨ Create Your Bundle & Save</h3>
          <p class="react-bundle-subtitle">Add complementary products and get up to 20% off</p>
          
          <div class="react-bundle-items">
            <div class="react-bundle-item" onclick="toggleBundle(this)">
              <input type="checkbox" class="react-bundle-checkbox">
              <img src="https://placehold.co/48x48?text=Bracelet" width="48px" height="48px" alt="Bracelet" class="react-bundle-image" />
              <div class="react-bundle-info">
                <p class="react-bundle-name">Solace Bracelet</p>
                <p class="react-bundle-desc">3mm Faceted Gemstone • Waterproof</p>
              </div>
              <p class="react-bundle-price">$39.00</p>
            </div>

            <div class="react-bundle-item" onclick="toggleBundle(this)">
              <input type="checkbox" class="react-bundle-checkbox">
              <img src="https://placehold.co/48x48?text=Anklet" width="48px" height="48px" alt="Anklet" class="react-bundle-image" />
              <div class="react-bundle-info">
                <p class="react-bundle-name">Solace Anklet</p>
                <p class="react-bundle-desc">3mm Faceted Gemstone • Waterproof</p>
              </div>
              <p class="react-bundle-price">$49.00</p>
            </div>
          </div>
        </div>
      {% endform %}
    </div>
  </div>
</div>

<script type="module">
  import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.3.8/dist/photoswipe-lightbox.esm.js';
  import PhotoSwipe from 'https://cdn.jsdelivr.net/npm/photoswipe@5.3.8/dist/photoswipe.esm.js';

  {%- assign image_media = product.media | where: "media_type", "image" -%}

  const productImages = [
    {% for media in image_media %}
      {
        // se preferir manter img_url, pode; aqui uso uma URL grande mas não "master" por performance
        src: "{{ media | image_url: width: 2400 }}",
        width: {{ media.width | default: 2400 }},
        height: {{ media.height | default: 2400 }},
        alt: {{ media.alt | json }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  let currentImageIndex = 0;

  const lightbox = new PhotoSwipeLightbox({
    dataSource: productImages,
    pswpModule: PhotoSwipe
  });

  lightbox.init();

  window.changeImage = function(element) {
    const mainImage = document.getElementById('MainImage-{{ section.id }}');
    const newSrc = element.getAttribute('data-image-src');
    const index = parseInt(element.getAttribute('data-index'), 10);

    if (mainImage && newSrc) {
      mainImage.src = newSrc;
      if (!Number.isNaN(index)) currentImageIndex = index;
    }

    document.querySelectorAll('.react-gallery__thumbnail').forEach((thumb) => {
      thumb.classList.remove('is-active');
    });
    element.classList.add('is-active');
  };

  window.openZoom = function() {
    if (!productImages.length) return;
    lightbox.loadAndOpen(currentImageIndex);
  };

  function adjustQuantity(delta) {
    var input = document.getElementById('Quantity');
    if (!input) return;

    var currentValue = parseInt(input.value, 10);
    if (isNaN(currentValue)) currentValue = 1;

    var newValue = currentValue + delta;
    if (newValue < 1) newValue = 1;

    input.value = String(newValue);

    input.dispatchEvent(new Event('input', { bubbles: true }));
    input.dispatchEvent(new Event('change', { bubbles: true }));
  }


</script>


{% schema %}
  {
    "name": "Product React Style",
    "class": "pro-page-react",
    "settings": [
      {
        "type": "checkbox",
        "id": "enable_payment_button",
        "label": "Show dynamic checkout button",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_quantity",
        "label": "Show quantity option",
        "default": true
      },
      {
       "type": "header",
       "content": "Sales points"
      },
      {
        "type": "html",
        "id": "svg-a",
        "label": "Svg Icon 1"
      },
       {
        "type": "text",
        "id": "a-text",
        "label": "Info 1"
      },
      {
        "type": "html",
        "id": "svg-b",
        "label": "Svg Icon 2"
      },
       {
        "type": "text",
        "id": "b-text",
        "label": "Info 2"
      },
      {
        "type": "html",
        "id": "svg-c",
        "label": "Svg Icon 3"
      },
       {
        "type": "text",
        "id": "c-text",
        "label": "Info 3"
      }
    ],
    "presets": [
      {
        "name": "Product React Style"
      }
    ]
  }
{% endschema %}